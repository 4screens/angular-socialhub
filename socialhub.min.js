/*
 4screens-socialhub v0.0.1
 (c) 2014 Nopattern sp. z o.o.
 License: proprietary
*/
"use strict";angular.module("4screens.socialhub",[]),angular.module("4screens.socialhub").directive("socialhubIsotopeDirective",["$rootScope","$timeout",function(e,t){var o=function(o,i){e.$on("SocialhubIsotopeDirectiveInitialize",function(){t(function(){o.iso=new Isotope(i[0],{itemSelector:".socialhub-isotope-tile-directive"}),e.$emit("SocialhubIsotopeDirectiveImagesLoaded")})}),e.$on("SocialhubIsotopeDirectiveImagesLoaded",function(){t(function(){var t=imagesLoaded(i);t.on("always",function(){e.$emit("SocialhubIsotopeDirectiveArrange")})})}),e.$on("SocialhubIsotopeDirectiveArrange",function(){t(function(){o.iso.reloadItems(),o.iso.arrange()})})};return{restrict:"C",link:o}}]),angular.module("4screens.socialhub").directive("socialhubIsotopeTileDirective",["$rootScope","$timeout",function(e,t){var o=function(o){o.$watch("$last",function(o){o&&t(function(){t(function(){e.$emit("SocialhubIsotopeDirectiveInitialize")})})})};return{restrict:"C",link:o}}]),angular.module("4screens.socialhub").factory("SocialhubBackendService",["CONFIG","socketService","$rootScope","$http","$q",function(e,t,o,i,n){function c(e){if(!e)throw"PostId has not been set!";return i.get(u.post.replace(":postid",e)).then(function(e){return 200===e.status?e.data:n.reject(e.data)})}function a(e){return e=e||{},i.get(u.posts,e).then(function(e){return 200===e.status?e.data:n.reject(e.data)})}var s=t.get(e.socialhub.namespace+e.socialhub.id),u={post:e.backend.domain+e.socialhub.post.replace(":id",e.socialhub.id),posts:e.backend.domain+e.socialhub.posts.replace(":id",e.socialhub.id)},r={};return s.on("socialhub:newPost",function(e){c(e).then(function(e){r.posts.unshift(e),o.$emit("SocialhubIsotopeDirectiveImagesLoaded")}).catch(function(t){404===t.status&&(_.remove(r.posts,{_id:e}),o.$emit("SocialhubIsotopeDirectiveImagesLoaded"))})}),{results:r,getLatest:function(e){return e=e||0,a({page:e}).then(function(e){return r.posts=(r.posts||[]).concat(e),e})}}}]);