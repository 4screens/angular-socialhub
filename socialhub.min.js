/*
 4screens-socialhub v0.0.1
 (c) 2014 Nopattern sp. z o.o.
 License: proprietary
*/
"use strict";angular.module("4screens.socialhub",[]),angular.module("4screens.socialhub").factory("SocialhubBackendService",["CONFIG","socketService","$http","$q",function(t,e,s,n){function o(t){if(!t)throw"PostId has not been set!";return s.get(u.post.replace(":postid",t)).then(function(t){return 200===t.status?t.data:n.reject(t.data)})}function a(t){return t=t||{},s.get(u.posts,t).then(function(t){return 200===t.status?t.data:n.reject(t.data)})}var c=e.get(t.socialhub.namespace+t.socialhub.id),u={post:t.backend.domain+t.socialhub.post.replace(":id",t.socialhub.id),posts:t.backend.domain+t.socialhub.posts.replace(":id",t.socialhub.id)},i={};return c.on("socialhub:newPost",function(t){o(t).then(function(t){i.posts.unshift(t)}).catch(function(e){404===e.status&&_.remove(i.posts,{_id:t})})}),{results:i,getLatest:function(t){return t=t||0,a({page:t}).then(function(t){return i.posts=(i.posts||[]).concat(t),t})}}}]);